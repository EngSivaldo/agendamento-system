{% extends "base.html" %}

{% block title %}Meus Agendamentos | AgendaPRO{% endblock %}

{% block content %}

<!-- HEADER -->
<header class="mb-5">
    <h1 class="fw-light text-warning border-bottom border-warning pb-2">
        <i class="fas fa-calendar-check me-3"></i>
        Seus Agendamentos
    </h1>
    <p class="lead text-pro-muted">
        Acompanhe seus serviços ativos, futuros e históricos.
    </p>
</header>

{% if agendamentos %}
<div class="row gy-4">

    {% for booking in agendamentos %}

    {% set card_border_class =
        'border-info' if booking.status == 'Pendente'
        else 'border-success' if booking.status == 'Confirmado'
        else 'border-danger'
    %}

    {% set badge_class =
        'bg-info' if booking.status == 'Pendente'
        else 'bg-success' if booking.status == 'Confirmado'
        else 'bg-danger'
    %}

    <div class="col-lg-6 col-md-12">

        <!-- CARD AGENDAMENTO -->
        <div class="card motion-card shadow-epic {{ card_border_class }}">

            <div class="card-body p-4">

                <!-- SERVIÇO -->
                <h5 class="fw-bold text-pro border-bottom border-secondary pb-2 mb-3">
                    <i class="fas fa-scissors me-2 text-warning"></i>
                    {{ booking.servico.nome }}
                </h5>

                <!-- INFO -->
                <ul class="list-unstyled small mb-4 text-pro-muted">
                    <li class="mb-2">
                        <strong>
                            <i class="fas fa-calendar-day me-2 text-warning"></i>
                            Data:
                        </strong>
                        <span class="text-pro">
                            {{ booking.data_agendamento.strftime('%d/%m/%Y') }}
                        </span>
                    </li>

                    <li class="mb-2">
                        <strong>
                            <i class="fas fa-clock me-2 text-warning"></i>
                            Horário:
                        </strong>
                        <span class="text-pro">
                            {{ booking.data_agendamento.strftime('%H:%M') }}
                        </span>
                    </li>

                    <li>
                        <strong>
                            <i class="fas fa-hourglass-half me-2 text-warning"></i>
                            Duração:
                        </strong>
                        <span class="text-pro">
                            {{ booking.servico.duracao }} minutos
                        </span>
                    </li>
                </ul>

                <!-- FOOTER CARD -->
                <div class="d-flex justify-content-between align-items-center pt-3 border-top border-secondary">

                    <!-- STATUS -->
                    <span class="badge {{ badge_class }} fs-6 fw-bold">
                        <i class="fas fa-info-circle me-1"></i>
                        {{ booking.status }}
                    </span>

                    <!-- AÇÕES -->
                    <div class="d-flex gap-2">

                        {% set data_formatada = booking.data_agendamento.strftime('%d/%m/%Y %H:%M') %}

                        <!-- CANCELAR -->
                        {% if booking.status == 'Pendente' and booking.data_agendamento >= hoje %}
                        <form method="POST"
                              action="{{ url_for('client.cancel_booking', booking_id=booking.id) }}"
                              onsubmit="return confirm('Deseja realmente cancelar o agendamento de {{ booking.servico.nome }} para {{ data_formatada }}?');">
                            <button type="submit"
                                    class="btn btn-sm btn-outline-warning fw-bold">
                                <i class="fas fa-ban me-1"></i>
                                Cancelar
                            </button>
                        </form>
                        {% endif %}

                        <!-- EXCLUIR DEFINITIVAMENTE -->
                        {% if booking.status in ['Pendente', 'Cancelado'] %}
                        <form method="POST"
                              action="{{ url_for('client.delete_booking', booking_id=booking.id) }}"
                              onsubmit="return confirm('⚠️ Esta ação é irreversível. Deseja EXCLUIR definitivamente este agendamento?');">
                            <button type="submit"
                                    class="btn btn-sm btn-outline-danger fw-bold">
                                <i class="fas fa-trash-alt me-1"></i>
                                Excluir
                            </button>
                        </form>
                        {% endif %}

                    </div>

                </div>

            </div>
        </div>

    </div>
    {% endfor %}

</div>

{% else %}

<!-- SEM AGENDAMENTOS -->
<div class="alert alert-dark shadow-epic border-info text-center p-4">
    <h4 class="alert-heading text-info">
        <i class="fas fa-calendar-xmark me-2"></i>
        Nenhum agendamento encontrado
    </h4>

    <p class="text-pro-muted mb-4">
        Você ainda não possui agendamentos ativos ou anteriores.
    </p>

    <a href="{{ url_for('client.index') }}"
       class="btn btn-warning fw-bold">
        <i class="fas fa-plus-circle me-2"></i>
        Agendar um serviço
    </a>
</div>

{% endif %}

{% endblock %}
